<!-- Hero Section -->
{% extends 'base.html' %}

{% block content %}
<!-- Content -->
<div class="container mx-auto p-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Create Your Video</h1>
    <p class="text-lg text-gray-600 mb-4">Generate videos with ease by submitting a script and media!</p>

    <!-- Video Creation Form -->
    <form id="videoForm" action="/generate-video" method="POST" enctype="multipart/form-data">
        <div class="mb-4">
            <label for="script" class="block text-gray-700">Enter Your Script</label>
            <textarea id="script" name="script" rows="4" class="w-full p-3 border border-gray-300 rounded-md" required
                placeholder="Write your script here..."></textarea>
        </div>

        <div class="mb-4">
            <label for="media" class="block text-gray-700">Upload Media Files</label>
            <input type="file" id="media" name="media" class="w-full p-3 border border-gray-300 rounded-md" multiple>
        </div>

        <div class="mb-4">
            <label for="videoTitle" class="block text-gray-700">Video Title</label>
            <input type="text" id="videoTitle" name="videoTitle" class="w-full p-3 border border-gray-300 rounded-md"
                required placeholder="Enter your video title">
        </div>

        <!-- Aspect Ratio Selection -->
        <div class="mb-4">
            <label for="aspectRatio" class="block text-gray-700">Select Video Aspect Ratio</label>
            <select id="aspectRatio" name="aspectRatio" class="w-full p-3 border border-gray-300 rounded-md">
                <option value="16:9">16:9 (Widescreen)</option>
                <option value="4:3">4:3 (Standard)</option>
                <option value="1:1">1:1 (Square)</option>
                <option value="9:16">9:16 (Vertical for Mobile)</option>
                <option value="21:9">21:9 (Cinematic)</option>
            </select>
        </div>

        <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600">Generate
            Video</button>
    </form>

    <div class="mt-6">
        <h2 class="text-2xl font-semibold text-gray-800">Generated Videos</h2>
        <ul id="videoList" class="mt-4"></ul>
    </div>
</div>

<script>
    // Listen for form submission to handle it via AJAX
    document.getElementById('videoForm').addEventListener('submit', async function (event) {
        event.preventDefault();  // Prevent normal form submission

        const formData = new FormData(this);  // Get the form data

        try {
            const response = await fetch('/generate-video', {
                method: 'POST',
                body: formData,
            });

            if (response.ok) {
                const data = await response.json();  // Assuming the server returns a JSON response
                console.log('Video generated successfully:', data);

                // Optionally, show a success message or update the video list
                alert('Video generated successfully!');
                fetchProcessedVideos();  // Fetch the updated video list
            } else {
                console.error('Failed to generate video');
                alert('Error generating video. Please try again!');
            }
        } catch (error) {
            console.error('Error submitting form:', error);
            alert('Error submitting form. Please try again!');
        }
    });

    // Fetch the list of generated videos from the backend
    async function fetchProcessedVideos() {
        try {
            const response = await fetch("/list-videos?type=scripted_video");
            const data = await response.json();
            const videoList = document.getElementById("videoList");
            videoList.innerHTML = "";  // Clear previous list

            if (data.videos && data.videos.length > 0) {
                data.videos.forEach((video) => {
                    const videoItem = document.createElement("li");
                    videoItem.classList.add("bg-white", "p-6", "rounded-lg", "shadow-lg");

                    const videoLink = document.createElement("a");
                    videoLink.href = video.url;
                    videoLink.textContent = video.name;
                    videoItem.appendChild(videoLink);
                    videoList.appendChild(videoItem);
                });
            } else {
                const noVideosMessage = document.createElement("p");
                noVideosMessage.classList.add("text-gray-500");
                noVideosMessage.textContent = "No videos generated yet.";
                videoList.appendChild(noVideosMessage);
            }
        } catch (error) {
            console.error("Error fetching processed videos:", error);
        }
    }

    // Load videos initially when the page is ready
    document.addEventListener("DOMContentLoaded", fetchProcessedVideos);
</script>
{% endblock %}